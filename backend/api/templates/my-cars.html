{% extends 'base.html' %}
{% load static %}

{% block title %}My Car Listings{% endblock %}

{% block content %}
  <h1>Your Car Listings</h1>
  <ul id="car-list"></ul>

  <script>
    // This function runs as soon as the page loads
    async function loadMyCars() {
      try {
        // Send GET request to the backend API
        const response = await fetch("http://localhost:8000/api/cars/mine/", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + localStorage.getItem("access_token"),
          },
        });

        // Convert the response to JSON
        const cars = await response.json();

        // Find the <ul> element where weâ€™ll add the cars
        const list = document.getElementById("car-list");

        // For each car in the response, create a list item
        cars.forEach(car => {
          const li = document.createElement("li");
          li.innerHTML = `<strong>${car.make} ${car.model}</strong> - $${car.price_per_day}/day`;
          list.appendChild(li);
        });

      } catch (error) {
        console.error("Error fetching cars:", error);
      }
    }

    // Call the function to load the cars
    loadMyCars();
  </script>
{% endblock %}
